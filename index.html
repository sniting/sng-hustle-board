<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SNG2.0's Hustle Board</title>

    <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-firestore-compat.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Poppins:wght@700;800&display=swap" rel="stylesheet">

    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="SNG Board">
    <link rel="apple-touch-icon" href="icon-192.png">
    <meta name="theme-color" content="#f97316">
    <style>
        :root { /* Color variables */
            --column-bg: rgba(17, 24, 39, 0.9);
            --column-header-text: #f8fafc;
            --task-bg: #ffffff; --task-text: #1f2937;
            --accent-todo: #f59e0b; --accent-done: #22c55e;
            --button-primary-bg: #dc2626; --button-primary-hover: #b91c1c;
            --info-box-bg: rgba(30, 41, 59, 0.88);
            --info-box-border: rgba(255, 255, 255, 0.2);
            --info-box-text: #f1f5f9;
            --input-bg: #1e293b; /* slate-800 */
            --input-text: #f1f5f9; /* slate-100 */
            --input-border: #475569; /* slate-600 */
            --summary-bg: rgba(30, 41, 59, 0.9); --summary-header: #facc15; --summary-text: #cbd5e1; --summary-strong: #fde047;
            --nitin-accent: #60a5fa; --sathu-accent: #f472b6;
            --nav-bg: rgba(17, 24, 39, 0.9);
            --nav-button-bg: rgba(255, 255, 255, 0.1);
            --nav-button-hover: rgba(255, 255, 255, 0.2);
            --nav-button-active: #f97316;
            --notes-bg: rgba(30, 41, 59, 0.92);
            --notes-header: #eab308;
            --notes-text: #e5e7eb;
            --priority-mandatory: #ef4444; --priority-moderate: #f59e0b; --priority-chill: #22c55e;
            /* Stronger Text Shadow for contrast */
            --text-shadow-heavy: 0px 1px 4px rgba(0,0,0,0.9), 1px 2px 3px rgba(0,0,0,0.8);
            --text-shadow-light: 0px 1px 3px rgba(0,0,0,0.7), 1px 1px 2px rgba(0,0,0,0.6);
        }

        body {
            font-family: 'Inter', sans-serif;
            background-image: url('https://raw.githubusercontent.com/sniting/sng-hustle-board/main/game-of-thrones-season-8-cartoon-1y7i9ou5f2clujq6.jpg');
            background-size: cover; background-position: center center; background-repeat: no-repeat; background-attachment: fixed;
            background-color: #374151; /* Fallback */
            padding: 2rem 1rem 5rem 1rem; color: var(--info-box-text);
            overflow-x: hidden; min-height: 100vh;
        }
        h1, h2, h3 { font-family: 'Poppins', sans-serif; font-weight: 800; letter-spacing: 0.02em; }

        #main-content-wrapper { max-width: 1200px; margin: 0 auto; }

        #main-title { color: #ffffff; text-shadow: var(--text-shadow-heavy); animation: pulse-glow 3s infinite alternate; }
        #subtitle { color: #f1f5f9; text-shadow: var(--text-shadow-light); }

        @keyframes pulse-glow { from { text-shadow: var(--text-shadow-heavy), 0 0 5px rgba(255,255,255,0.3); } to { text-shadow: var(--text-shadow-heavy), 0 0 15px rgba(255,255,255,0.5); } }

         /* Navigation */
         #app-navigation { display: flex; justify-content: center; gap: 0.75rem; margin-bottom: 2rem; padding: 0.5rem; background-color: var(--nav-bg); border-radius: 0.75rem; max-width: 500px; margin-left: auto; margin-right: auto; box-shadow: 0 4px 10px rgba(0,0,0,0.2); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
         .nav-button { padding: 0.5rem 1rem; border: none; border-radius: 0.5rem; background-color: var(--nav-button-bg); color: var(--column-header-text); font-family: 'Poppins', sans-serif; font-weight: 700; cursor: pointer; transition: all 0.2s ease-out; font-size: 0.9rem; text-shadow: var(--text-shadow-light); }
         .nav-button:hover { background-color: var(--nav-button-hover); transform: translateY(-2px); }
         .nav-button.active { background-color: var(--nav-button-active); color: white; box-shadow: 0 0 10px rgba(249, 115, 22, 0.5); }

         /* View Containers */
         .view-container { display: none; }
         .view-container.active { display: block; }

         /* Info Boxes (Time, Quote, Date) */
         .info-box-container { display: flex; flex-direction: column; align-items: center; gap: 1rem; margin-bottom: 1.5rem; }
         #time-date-display, #selected-date-display, #motivational-quote {
            background-color: var(--info-box-bg); backdrop-filter: blur(10px); border: 1px solid var(--info-box-border);
            padding: 0.8rem 1.2rem; border-radius: 0.6rem; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            text-align: center; width: 100%; max-width: 550px; color: var(--info-box-text); font-weight: 600;
            text-shadow: var(--text-shadow-light); transition: all 0.3s ease-out;
            margin-left: 0; margin-right: 0; margin-bottom: 0; min-height: 40px;
         }
         #time-date-display:hover, #selected-date-display:hover, #motivational-quote:hover { transform: translateY(-4px) scale(1.02); box-shadow: 0 8px 16px rgba(0, 0, 0, 0.25); }
         #selected-date-display { background-color: rgba(51, 65, 85, 0.9); color: #ffffff; font-weight: 700; border-color: rgba(255, 255, 255, 0.3); }
         #motivational-quote { background-color: rgba(17, 24, 39, 0.85); border: 1px solid var(--quote-border); color: var(--quote-text); padding: 1rem 1.2rem; font-size: 1rem; font-weight: 500; font-style: normal; text-shadow: var(--text-shadow-light); }

         /* Date Selector */
         #date-selector-container { text-align: center; margin-bottom: 1.5rem; }
         #date-selector-container label { margin-right: 0.5rem; font-weight: 700; color: #f1f5f9; text-shadow: var(--text-shadow-light); }
         #date-selector { padding: 0.6rem 0.8rem; border: 1px solid rgba(255,255,255,0.3); border-radius: 0.5rem; box-shadow: inset 0 1px 3px 0 rgba(0,0,0,0.1); cursor: pointer; background-color: rgba(30, 41, 59, 0.85); color: #ffffff; font-weight: 500; }

         /* Add Task Form */
         #add-task-form-container {
             background-color: rgba(30, 41, 59, 0.92);
             backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.2);
             padding: 1.75rem; border-radius: 0.75rem; box-shadow: 0 8px 20px rgba(0, 0, 0, 0.25);
             transition: all 0.35s ease-out; margin-bottom: 3.5rem;
         }
         #add-task-form-container:hover { transform: scale(1.01); box-shadow: 0 12px 25px rgba(0, 0, 0, 0.3); }
         #add-task-form { /* Responsive grid layout remains same */ }
         #add-task-form label { /* Styles remain same */ text-shadow: 1px 1px 1px rgba(0,0,0,0.3); }
         /* Input field background/text color fix */
         #add-task-form input[type="text"],
         #add-task-form input[type="time"] {
             width: 100%; border: 1px solid var(--input-border); border-radius: 0.5rem; padding: 0.6rem 0.9rem;
             box-shadow: inset 0 1px 3px 0 rgba(0,0,0,0.1); font-size: 0.9rem;
             background-color: var(--input-bg); color: var(--input-text);
         }
         #add-task-form button { /* Styles remain same */ }
         #add-task-form button:hover { /* Styles remain same */ }
         #user-selector-container fieldset { /* Styles remain same */ }
         #user-selector-container legend { /* Styles remain same */ text-shadow: 1px 1px 2px rgba(0,0,0,0.3); }
         #user-selector-container div { /* Styles remain same */ }
         #user-selector-container label { /* Styles remain same */ text-shadow: 1px 1px 1px rgba(0,0,0,0.2); }
         #user-selector-container input[type="checkbox"] { /* Styles remain same */ }

         /* Kanban Board Area - Stacked Layout */
         #kanban-boards-container {
            display: grid; grid-template-columns: 1fr; gap: 2.5rem; margin-top: 2rem;
            max-width: 768px; margin-left: auto; margin-right: auto;
         }

        .user-board { }
        .user-board-header { text-align: center; font-size: 1.5rem; font-weight: 800; color: var(--column-header-text); margin-bottom: 1.5rem; text-shadow: var(--text-shadow-heavy); }
        #nitin-board .user-board-header { color: var(--nitin-accent); }
        #sathu-board .user-board-header { color: var(--sathu-accent); }

        .kanban-columns-grid {
             display: grid; grid-template-columns: 1fr; gap: 1.5rem;
        }
        @media (min-width: 640px) {
            .kanban-columns-grid { grid-template-columns: 1fr 1fr; gap: 1.5rem; }
        }

        .kanban-column {
            min-height: 350px; background-color: var(--column-bg); backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 0.75rem; padding: 1.25rem;
            transition: all 0.35s ease-out; box-shadow: 0 10px 20px rgba(0, 0, 0, 0.25);
        }
        .kanban-column:hover { transform: scale(1.02); box-shadow: 0 15px 35px rgba(0, 0, 0, 0.35); }
        .kanban-column h2 { color: var(--column-header-text); text-transform: uppercase; font-weight: 700; display: flex; align-items: center; justify-content: center; gap: 0.6rem; border-bottom: 2px solid rgba(255, 255, 255, 0.2); padding-bottom: 0.75rem; margin-bottom: 1.25rem; text-shadow: var(--text-shadow-light); }
        #nitin-todo h2, #nitin-done h2 { color: var(--nitin-accent); }
        #sathu-todo h2, #sathu-done h2 { color: var(--sathu-accent); }


        .kanban-task {
            background-color: var(--task-bg); color: var(--task-text); border-radius: 0.5rem;
            padding: 0.8rem 1.1rem; padding-right: 2.5rem; /* Ensure space for delete button */
            margin-bottom: 1rem; cursor: grab; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.25s ease-in-out; word-break: break-word; position: relative;
            border-left: 5px solid var(--accent-todo);
        }
        #nitin-todo .kanban-task[data-assigned-user="nitin"] { border-left-color: var(--nitin-accent); }
        #sathu-todo .kanban-task[data-assigned-user="sathu"] { border-left-color: var(--sathu-accent); }
        #nitin-done .kanban-task, #sathu-done .kanban-task { border-left-color: var(--accent-done); }

        .task-content-display { }
        .task-time-info { /* Styles remain same */ }
        .task-time-info .duration { /* Styles remain same */ }
        .task-completion-date { /* Styles remain same */ }
        .kanban-task:active:not(.editing) { /* Styles remain same */ }
        .dragging { /* Styles remain same */ }
        .drag-over { /* Styles remain same */ }

         /* Edit/Delete Styles */
         .task-edit-form { /* Styles remain same */ }
         .task-edit-form input[type="text"], .task-edit-form input[type="time"] { /* Styles remain same */ }
         .task-edit-form .edit-time-inputs { /* Styles remain same */ }
         .task-edit-form .edit-time-inputs > div { /* Styles remain same */ }
         .task-edit-form .edit-buttons { /* Styles remain same */ }
         .task-edit-form button { /* Styles remain same */ }
         .edit-save-btn { /* Styles remain same */ }
         .edit-save-btn:hover { /* Styles remain same */ }
         .edit-cancel-btn { /* Styles remain same */ }
         .edit-cancel-btn:hover { /* Styles remain same */ }
         /* Delete Button Position Fix */
         .delete-task-btn {
             position: absolute;
             top: 0.5rem;
             right: 0.5rem;
             background: none; border: none; color: #fca5a5; font-size: 1.3rem;
             line-height: 1; cursor: pointer; padding: 0;
             opacity: 0.4; transition: all 0.2s ease; z-index: 10;
         }
         .kanban-task:hover .delete-task-btn { opacity: 0.8; }
         .delete-task-btn:hover { opacity: 1; color: #ef4444; transform: scale(1.15) rotate(10deg); }
         .kanban-task.editing { /* Styles remain same */ }

         /* --- Notes Page Styles --- */
         .notes-view { background-color: var(--notes-bg); padding: 1.5rem; border-radius: 0.75rem; box-shadow: 0 8px 20px rgba(0,0,0,0.2); border: 1px solid rgba(255, 255, 255, 0.15); backdrop-filter: blur(10px); max-width: 900px; margin: 1rem auto; }
         .notes-view h3 { color: var(--notes-header); text-align: center; margin-bottom: 1.5rem; font-size: 1.5rem; text-shadow: var(--text-shadow-medium); }
         .notes-section { margin-bottom: 2rem; }
         .notes-section h4 { color: var(--column-header-text); font-weight: 700; font-size: 1.1rem; margin-bottom: 1rem; border-bottom: 1px solid rgba(255, 255, 255, 0.2); padding-bottom: 0.5rem; text-shadow: 1px 1px 2px rgba(0,0,0,0.3); }
         .notes-form { /* Styles remain same */ }
         @media (min-width: 640px) { .notes-form { /* Styles remain same */ } }
         .notes-form label { /* Styles remain same */ }
         /* Input field background/text color fix */
         .notes-form input[type="text"],
         .notes-form select {
             width: 100%; border: 1px solid var(--input-border); border-radius: 0.5rem; padding: 0.6rem 0.9rem;
             box-shadow: inset 0 1px 3px 0 rgba(0,0,0,0.1); font-size: 0.9rem;
             background-color: var(--input-bg); color: var(--input-text); /* Apply dark bg, light text */
         }
         .notes-form select { appearance: none; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3E%3Cpath stroke='%239ca3af' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3E%3C/svg%3E"); background-position: right 0.5rem center; background-repeat: no-repeat; background-size: 1.5em 1.5em; padding-right: 2.5rem; }
         .notes-form button { /* Styles remain same */ }
         .notes-form button:hover { /* Styles remain same */ }
         .prioritized-task-list { /* Styles remain same */ }
         .prioritized-task-item { /* Styles remain same */ }
         .prioritized-task-item span { /* Styles remain same */ }
         .priority-badge { /* Styles remain same */ }
         .priority-Mandatory { /* Styles remain same */ }
         .priority-Moderate { /* Styles remain same */ }
         .priority-Chill { /* Styles remain same */ }
         .delete-note-task-btn { /* Styles remain same */ }
         .delete-note-task-btn:hover { /* Styles remain same */ }
         /* Input field background/text color fix */
         .freeform-notes-area textarea {
             width: 100%; min-height: 150px; border: 1px solid var(--input-border); border-radius: 0.5rem; padding: 0.6rem 0.9rem;
             font-size: 0.9rem; background-color: var(--input-bg); color: var(--input-text); /* Apply dark bg, light text */
             resize: vertical; margin-bottom: 0.75rem;
         }
         .freeform-notes-area button { /* Styles remain same */ }
         .freeform-notes-area button:hover { /* Styles remain same */ }

    </style>
</head>
<body class="p-4 md:p-8">

    <div id="main-content-wrapper">

        <h1 id="main-title" class="text-5xl font-extrabold text-center mb-2">SNG2.0's Hustle Board</h1>
        <p id="subtitle" class="text-center text-lg mb-6">Plan & Conquer.</p>

        <nav id="app-navigation">
            <button class="nav-button active" data-view="hustle-board-view">Hustle Board</button>
            <button class="nav-button" data-view="nitin-notes-view">Nitin's Notes</button>
            <button class="nav-button" data-view="sathu-notes-view">Sathu's Notes</button>
        </nav>

        <div id="hustle-board-view" class="view-container active">
            <div class="info-box-container">
                <div id="time-date-display" class="text-base">Loading time...</div>
                <div id="motivational-quote">Loading inspiration...</div>
                <div id="date-selector-container">
                    <label for="date-selector">Select Date:</label>
                    <input type="date" id="date-selector">
                </div>
                <div id="selected-date-display" class="text-lg">Loading tasks for...</div>
            </div>
            <div class="mb-10 max-w-xl mx-auto" id="add-task-form-container">
                <h2 class="text-2xl font-bold mb-5 text-center text-slate-100">Add New Hustle</h2>
                <div id="add-task-form">
                     <div> <label for="new-task-input">Task:</label> <input type="text" id="new-task-input" placeholder="Define the next victory..." class="focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent"> </div>
                     <div> <label for="new-task-start-time">Start:</label> <input type="time" id="new-task-start-time" class="focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent"> </div>
                     <div> <label for="new-task-end-time">End:</label> <input type="time" id="new-task-end-time" class="focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent"> </div>
                     <div id="user-selector-container"> <fieldset> <legend>Assign To:</legend> <div> <label for="user-nitin"> <input type="checkbox" id="user-nitin" value="nitin" checked> Nitin </label> <label for="user-sathu"> <input type="checkbox" id="user-sathu" value="sathu"> Sathu </label> </div> </fieldset> </div>
                     <div> <button id="add-task-btn" class="w-full">Lock It In</button> </div>
                </div>
            </div>

            <div id="kanban-boards-container">
                <div id="nitin-board" class="user-board">
                    <h3 class="user-board-header">Nitin's Board</h3>
                    <div class="kanban-columns-grid"> <div id="nitin-todo" class="kanban-column" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)" ondrop="handleDrop(event)">
                            <h2 class="text-xl mb-5">🎯 To Do</h2>
                        </div>
                        <div id="nitin-done" class="kanban-column" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)" ondrop="handleDrop(event)">
                            <h2 class="text-xl mb-5">🏆 Done!</h2>
                        </div>
                    </div>
                </div>
                <div id="sathu-board" class="user-board">
                     <h3 class="user-board-header">Sathu's Board</h3>
                     <div class="kanban-columns-grid"> <div id="sathu-todo" class="kanban-column" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)" ondrop="handleDrop(event)">
                            <h2 class="text-xl mb-5">🎯 To Do</h2>
                        </div>
                        <div id="sathu-done" class="kanban-column" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)" ondrop="handleDrop(event)">
                            <h2 class="text-xl mb-5">🏆 Done!</h2>
                        </div>
                    </div>
                </div>
            </div> <div id="daily-summary" class="hidden">
                <h3 class="text-xl font-bold">Daily Wins Recap!</h3>
                <p id="summary-content">No summary available yet.</p>
            </div>
        </div>

        <div id="nitin-notes-view" class="view-container notes-view">
            <h3>Nitin's Notes & Priorities</h3>
            <div class="notes-section"> <h4>Prioritized Tasks</h4> <form id="nitin-notes-form" class="notes-form"> <div> <label for="nitin-note-task">Task Description:</label> <input type="text" id="nitin-note-task" placeholder="Enter prioritized task..."> </div> <div> <label for="nitin-note-priority">Priority:</label> <select id="nitin-note-priority"> <option value="Mandatory">Mandatory</option> <option value="Moderate">Moderate</option> <option value="Chill">Chill</option> </select> </div> <button type="submit">Add Priority Task</button> </form> <ul id="nitin-prioritized-tasks" class="prioritized-task-list"></ul> </div>
            <div class="notes-section freeform-notes-area"> <h4>Routine / Freeform Notes</h4> <textarea id="nitin-freeform-notes" placeholder="Jot down routines, ideas, anything..."></textarea> <button id="save-nitin-notes">Save Notes</button> </div>
        </div>

        <div id="sathu-notes-view" class="view-container notes-view">
             <h3>Sathu's Notes & Priorities</h3>
             <div class="notes-section"> <h4>Prioritized Tasks</h4> <form id="sathu-notes-form" class="notes-form"> <div> <label for="sathu-note-task">Task Description:</label> <input type="text" id="sathu-note-task" placeholder="Enter prioritized task..."> </div> <div> <label for="sathu-note-priority">Priority:</label> <select id="sathu-note-priority"> <option value="Mandatory">Mandatory</option> <option value="Moderate">Moderate</option> <option value="Chill">Chill</option> </select> </div> <button type="submit">Add Priority Task</button> </form> <ul id="sathu-prioritized-tasks" class="prioritized-task-list"></ul> </div>
             <div class="notes-section freeform-notes-area"> <h4>Routine / Freeform Notes</h4> <textarea id="sathu-freeform-notes" placeholder="Jot down routines, ideas, anything..."></textarea> <button id="save-sathu-notes">Save Notes</button> </div>
        </div>

    </div> <canvas id="confetti-canvas"></canvas>

    <script>
        // --- Firebase Configuration ---
        const firebaseConfig = {
          apiKey: "AIzaSyCVrpXIbpjQMr_UZJPbFzQJl0xPX52qVhM",
          authDomain: "sng-hustle-board.firebaseapp.com",
          projectId: "sng-hustle-board",
          storageBucket: "sng-hustle-board.appspot.com",
          messagingSenderId: "46213905924",
          appId: "1:46213905924:web:6a6d48b11e0f36ce3e7f51"
        };

        // --- Initialize Firebase ---
        let db;
        try {
            firebase.initializeApp(firebaseConfig);
            db = firebase.firestore();
            console.log("Firebase initialized successfully.");
        } catch (error) {
            console.error("Firebase initialization failed:", error);
            alert("Could not connect to the database. Please check your Firebase configuration and internet connection.");
        }
        const tasksCollection = db ? db.collection("tasks") : null;
        const archiveCollection = db ? db.collection("archive") : null;
        const notesCollection = db ? db.collection("notes") : null;

        // --- Constants / State / Utils / Data Management / Core Functions ---
        // All JavaScript logic below this point remains unchanged from the previous version

        // --- Constants ---
        const BOSTON_TIMEZONE = 'America/New_York';
        const PRIORITY_MAP = { "Mandatory": 3, "Moderate": 2, "Chill": 1 };

        // --- Motivational Quotes ---
        const motivationalQuotes = [ "Believe you can and you're halfway there. - Theodore Roosevelt", "The journey of a thousand miles begins with a single step. - Lao Tzu", "What lies behind us and what lies before us are tiny matters compared to what lies within us. - Ralph Waldo Emerson", "Your task is not to seek for love, but merely to seek and find all the barriers within yourself that you have built against it. - Rumi", "The mind is everything. What you think you become. - Buddha", "Do not dwell in the past, do not dream of the future, concentrate the mind on the present moment. - Buddha", "Act as if what you do makes a difference. It does. - William James", "You are never too old to set another goal or to dream a new dream. - C.S. Lewis", "The best way to predict the future is to create it. - Peter Drucker", "Our greatest glory is not in never failing, but in rising up every time we fail. - Ralph Waldo Emerson", "Know thyself. - Socrates", "Peace comes from within. Do not seek it without. - Buddha", "The only true wisdom is in knowing you know nothing. - Socrates", "When you arise in the morning, think of what a precious privilege it is to be alive - to breathe, to think, to enjoy, to love. - Marcus Aurelius", "Turn your wounds into wisdom. - Oprah Winfrey", "The only way to do great work is to love what you do. - Steve Jobs", "Your talent determines what you can do. Your motivation determines how much you are willing to do. Your attitude determines how well you do it. - Lou Holtz", "Don’t limit yourself. Many people limit themselves to what they think they can do. You can go as far as your mind lets you. What you believe, remember, you can achieve. - Mary Kay Ash", "It's hard to beat a person who never gives up. - Babe Ruth", "If you don't sacrifice for what you want, what you want becomes the sacrifice. - Unknown", "I am not a product of my circumstances. I am a product of my decisions. - Stephen R. Covey", "The only way out is in. - Sadhguru", "Responsibility is not a burden; it is a tremendous possibility. - Sadhguru", "If you resist change, you resist life. - Sadhguru", "Don't be dead serious about your life - it's just a play. - Sadhguru", "The sign of intelligence is that you are constantly wondering. Idiots are always dead sure about every damn thing they are doing in their life. - Sadhguru", "Talent without working hard is nothing. - Cristiano Ronaldo", "Your love makes me strong, your hate makes me unstoppable. - Cristiano Ronaldo", "You have to fight to reach your dream. You have to sacrifice and work hard for it. - Lionel Messi", "Whether it’s a friendly match, or for points, or a final, or any game – I play the same. I’m always trying to be my best, first for my team, for myself, for the fans, and to try and win. - Lionel Messi", "Self-belief and hard work will always earn you success. - Virat Kohli", "The people you choose to have around you make all the difference. - Virat Kohli", "I hated every minute of training, but I said, 'Don't quit. Suffer now and live the rest of your life as a champion.' - Muhammad Ali", "He who is not courageous enough to take risks will accomplish nothing in life. - Muhammad Ali", "Champions aren't made in gyms. Champions are made from something they have deep inside them—a desire, a dream, a vision. - Muhammad Ali", "Success is stumbling from failure to failure with no loss of enthusiasm. While persistence isn't always the key, passion and hard work is. - Anirudh Ravichander (Paraphrased common sentiment)", "Music is language. It has the power to transcend boundaries. - A. R. Rahman", "Your inner voice is the voice of divinity. To hear it, we need to be in solitude, even in crowded places. - A. R. Rahman", "Be original and find your identity. The world will follow. - A. R. Rahman (Inspired by his philosophy)" ];
        let currentQuoteIndex = -1;

        // --- DOM Elements ---
        const timeDateDisplay = document.getElementById('time-date-display'); const dateSelector = document.getElementById('date-selector'); const selectedDateDisplay = document.getElementById('selected-date-display'); const dailySummaryDiv = document.getElementById('daily-summary'); const summaryContentP = document.getElementById('summary-content'); const confettiCanvas = document.getElementById('confetti-canvas'); const quoteDisplay = document.getElementById('motivational-quote');
        const navigationButtons = document.querySelectorAll('.nav-button');
        const viewContainers = document.querySelectorAll('.view-container');

        // --- Confetti Setup ---
        const myConfetti = confetti.create(confettiCanvas, { resize: true, useWorker: true });

        // --- State ---
        let draggedTask = null; let currentSelectedDate = '';
        let currentView = 'hustle-board-view';

        // --- Utility Functions ---
        function getCurrentDateString(timeZone) { const now = new Date(); const formatter = new Intl.DateTimeFormat('en-CA', { year: 'numeric', month: '2-digit', day: '2-digit', timeZone: timeZone }); return formatter.format(now); }
        function getCurrentTimeString(timeZone) { const now = new Date(); const formatter = new Intl.DateTimeFormat('en-GB', { hour: '2-digit', minute: '2-digit', hour12: false, timeZone: timeZone }); return formatter.format(now); }
        function formatLiveDateTime(timeZone) { const now = new Date(); const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', hour: 'numeric', minute: '2-digit', timeZoneName: 'short', timeZone: timeZone }; return now.toLocaleString('en-US', options); }
        function formatDisplayDate(dateString) { if (!dateString) return "Invalid Date"; const [year, month, day] = dateString.split('-'); const date = new Date(Date.UTC(year, month - 1, day)); const options = { year: 'numeric', month: 'long', day: 'numeric', timeZone: 'UTC' }; return date.toLocaleDateString('en-US', options); }
        function calculateDuration(startTime, endTime) { if (!startTime || !endTime) return ""; try { const start = new Date(`1970-01-01T${startTime}:00`); const end = new Date(`1970-01-01T${endTime}:00`); if (isNaN(start) || isNaN(end) || end <= start) return ""; let diffMillis = end - start; const hours = Math.floor(diffMillis / (1000 * 60 * 60)); diffMillis -= hours * (1000 * 60 * 60); const minutes = Math.floor(diffMillis / (1000 * 60)); let durationStr = ""; if (hours > 0) durationStr += `${hours}h `; if (minutes > 0) durationStr += `${minutes}m`; return durationStr.trim(); } catch (e) { console.error("Error calculating duration:", e); return ""; } }

        // --- Data Management Functions (Firestore) ---
        async function loadTasksFromFirestore(dateString) { if (!db || !tasksCollection) { console.error("Firestore not initialized."); return { nitin: { todo: [], done: [] }, sathu: { todo: [], done: [] } }; } console.log(`Loading tasks for ${dateString} from Firestore...`); const docRef = tasksCollection.doc(dateString); try { const docSnap = await docRef.get(); if (docSnap.exists) { const data = docSnap.data(); return { nitin: { todo: data.nitin?.todo || [], done: data.nitin?.done || [] }, sathu: { todo: data.sathu?.todo || [], done: data.sathu?.done || [] } }; } else { console.log("No document found for this date."); return { nitin: { todo: [], done: [] }, sathu: { todo: [], done: [] } }; } } catch (error) { console.error("Error getting document:", error); return { nitin: { todo: [], done: [] }, sathu: { todo: [], done: [] } }; } }
        async function saveTasksToFirestore(dateString, tasksByUserData) { if (!db || !tasksCollection) { console.error("Firestore not initialized."); return; } if (!dateString) { console.error("Cannot save tasks without a dateString."); return; } const dataToSave = { nitin: { todo: tasksByUserData.nitin?.todo || [], done: tasksByUserData.nitin?.done || [] }, sathu: { todo: tasksByUserData.sathu?.todo || [], done: tasksByUserData.sathu?.done || [] } }; console.log(`Saving tasks for ${dateString} to Firestore...`, dataToSave); const docRef = tasksCollection.doc(dateString); try { await docRef.set(dataToSave); console.log("Tasks successfully saved for date:", dateString); } catch (error) { console.error("Error saving tasks:", error); alert("Error saving tasks to the database."); } }
        async function loadNotesFromFirestore(user) { if (!db || !notesCollection) { console.error("Firestore not initialized."); return { prioritizedTasks: [], freeformNotes: "" }; } console.log(`Loading notes for ${user} from Firestore...`); const docRef = notesCollection.doc(user); try { const docSnap = await docRef.get(); if (docSnap.exists) { const data = docSnap.data(); return { prioritizedTasks: data.prioritizedTasks || [], freeformNotes: data.freeformNotes || "" }; } else { console.log(`No notes document found for ${user}, returning empty.`); return { prioritizedTasks: [], freeformNotes: "" }; } } catch (error) { console.error(`Error getting notes for ${user}:`, error); return { prioritizedTasks: [], freeformNotes: "" }; } }
        async function saveNotesToFirestore(user, notesData) { if (!db || !notesCollection) { console.error("Firestore not initialized."); return; } if (!user) { console.error("Cannot save notes without a user."); return; } console.log(`Saving notes for ${user} to Firestore...`, notesData); const docRef = notesCollection.doc(user); try { await docRef.set(notesData, { merge: true }); console.log(`Notes successfully saved for ${user}`); } catch (error) { console.error(`Error saving notes for ${user}:`, error); alert(`Error saving notes for ${user}.`); } }

        // --- Core Application Logic ---
        function switchView(viewId) { console.log("Switching view to:", viewId); currentView = viewId; viewContainers.forEach(container => { container.classList.toggle('active', container.id === viewId); }); navigationButtons.forEach(button => { button.classList.toggle('active', button.dataset.view === viewId); }); if (viewId === 'hustle-board-view') { if (currentSelectedDate) { displayTasksForDate(currentSelectedDate); } } else if (viewId === 'nitin-notes-view') { loadAndDisplayNotes('nitin'); } else if (viewId === 'sathu-notes-view') { loadAndDisplayNotes('sathu'); } }

        // --- Kanban Board Functions ---
        function updateTimeDisplay() { if (timeDateDisplay) timeDateDisplay.textContent = formatLiveDateTime(BOSTON_TIMEZONE); }
        function clearBoard() { document.querySelectorAll('.kanban-column').forEach(column => { column.querySelectorAll('.kanban-task').forEach(task => task.remove()); }); }
        function createTaskDisplayContent(taskData) { const displayWrapper = document.createElement('div'); displayWrapper.classList.add('task-content-display'); const textNode = document.createTextNode(taskData.text); displayWrapper.appendChild(textNode); if (taskData.startTime && taskData.endTime) { const timeInfoSpan = document.createElement('span'); timeInfoSpan.classList.add('task-time-info'); const duration = calculateDuration(taskData.startTime, taskData.endTime); timeInfoSpan.innerHTML = `${taskData.startTime} - ${taskData.endTime}` + (duration ? ` <span class="duration">(${duration})</span>` : ''); displayWrapper.appendChild(timeInfoSpan); } if (taskData.completionDate) { const dateSpan = document.createElement('span'); dateSpan.classList.add('task-completion-date'); dateSpan.textContent = `Completed: ${taskData.completionDate}`; displayWrapper.appendChild(dateSpan); } return displayWrapper; }
        function createTaskElement(taskData, assignedUser) { const taskId = taskData.firestoreId || `task-${Date.now()}`; const { text, startTime, endTime, completionDate } = taskData; const task = document.createElement('div'); task.classList.add('kanban-task'); task.setAttribute('draggable', 'true'); task.id = taskId; task.dataset.text = text; task.dataset.assignedUser = assignedUser; if (startTime) task.dataset.startTime = startTime; if (endTime) task.dataset.endTime = endTime; if (completionDate) task.dataset.completionDate = completionDate; const displayContent = createTaskDisplayContent(taskData); task.appendChild(displayContent); const deleteBtn = document.createElement('button'); deleteBtn.classList.add('delete-task-btn'); deleteBtn.innerHTML = '&times;'; deleteBtn.setAttribute('aria-label', 'Delete task'); deleteBtn.onclick = async (event) => { event.stopPropagation(); if (confirm(`Are you sure you want to delete task: "${task.dataset.text}"?`)) { task.remove(); await saveCurrentBoardState(); } }; task.appendChild(deleteBtn); task.addEventListener('dragstart', (event) => { if (task.classList.contains('editing')) { event.preventDefault(); return; } draggedTask = event.target; event.dataTransfer.setData('text/plain', event.target.id); setTimeout(() => event.target.classList.add('dragging'), 0); }); task.addEventListener('dragend', () => { if (draggedTask) draggedTask.classList.remove('dragging'); draggedTask = null; }); task.addEventListener('dblclick', (event) => { if (event.target === deleteBtn) return; enterEditMode(task); }); return task; }
        function enterEditMode(taskElement) { if (taskElement.classList.contains('editing')) return; taskElement.classList.add('editing'); taskElement.setAttribute('draggable', 'false'); const displayContent = taskElement.querySelector('.task-content-display'); if (displayContent) displayContent.style.display = 'none'; const editForm = document.createElement('div'); editForm.classList.add('task-edit-form'); const textInput = document.createElement('input'); textInput.type = 'text'; textInput.value = taskElement.dataset.text || ''; textInput.placeholder = 'Task description'; const timeInputsDiv = document.createElement('div'); timeInputsDiv.classList.add('edit-time-inputs'); const startTimeDiv = document.createElement('div'); const startTimeInput = document.createElement('input'); startTimeInput.type = 'time'; startTimeInput.value = taskElement.dataset.startTime || ''; startTimeDiv.appendChild(startTimeInput); const endTimeDiv = document.createElement('div'); const endTimeInput = document.createElement('input'); endTimeInput.type = 'time'; endTimeInput.value = taskElement.dataset.endTime || ''; endTimeDiv.appendChild(endTimeInput); timeInputsDiv.appendChild(startTimeDiv); timeInputsDiv.appendChild(endTimeDiv); const buttonsDiv = document.createElement('div'); buttonsDiv.classList.add('edit-buttons'); const saveBtn = document.createElement('button'); saveBtn.textContent = 'Save'; saveBtn.classList.add('edit-save-btn'); saveBtn.onclick = () => saveEdit(taskElement, textInput, startTimeInput, endTimeInput); const cancelBtn = document.createElement('button'); cancelBtn.textContent = 'Cancel'; cancelBtn.classList.add('edit-cancel-btn'); cancelBtn.onclick = () => cancelEdit(taskElement); buttonsDiv.appendChild(saveBtn); buttonsDiv.appendChild(cancelBtn); editForm.appendChild(textInput); editForm.appendChild(timeInputsDiv); editForm.appendChild(buttonsDiv); taskElement.appendChild(editForm); textInput.focus(); }
        function exitEditMode(taskElement) { const editForm = taskElement.querySelector('.task-edit-form'); if (editForm) editForm.remove(); const displayContent = taskElement.querySelector('.task-content-display'); if (displayContent) displayContent.style.display = ''; taskElement.classList.remove('editing'); taskElement.setAttribute('draggable', 'true'); }
        async function saveEdit(taskElement, textInput, startTimeInput, endTimeInput) { const newText = textInput.value.trim(); const newStartTime = startTimeInput.value; const newEndTime = endTimeInput.value; if (newText === '') { alert('Task description cannot be empty.'); textInput.focus(); return; } if (!newStartTime) { alert('Please enter a start time.'); startTimeInput.focus(); return; } if (!newEndTime) { alert('Please enter an end time.'); endTimeInput.focus(); return; } if (newStartTime >= newEndTime) { alert('End time must be after start time.'); endTimeInput.focus(); return; } taskElement.dataset.text = newText; taskElement.dataset.startTime = newStartTime; taskElement.dataset.endTime = newEndTime; const completionDate = taskElement.dataset.completionDate || null; const assignedUser = taskElement.dataset.assignedUser; const displayContent = taskElement.querySelector('.task-content-display'); if (displayContent) { while (displayContent.firstChild) { displayContent.removeChild(displayContent.firstChild); } const updatedDisplayData = { text: newText, startTime: newStartTime, endTime: newEndTime, completionDate: completionDate }; const newDisplay = createTaskDisplayContent(updatedDisplayData); while (newDisplay.firstChild) { displayContent.appendChild(newDisplay.firstChild); } } exitEditMode(taskElement); await saveCurrentBoardState(); console.log("Task edited and saved:", taskElement.id); }
        function cancelEdit(taskElement) { exitEditMode(taskElement); console.log("Task edit cancelled:", taskElement.id); }
        async function displayTasksForDate(dateString) { if (!db) { selectedDateDisplay.textContent = "Database not connected."; return; } currentSelectedDate = dateString; selectedDateDisplay.textContent = `Loading tasks for ${formatDisplayDate(dateString)}...`; dateSelector.value = dateString; clearBoard(); try { const tasksByUserData = await loadTasksFromFirestore(dateString); selectedDateDisplay.textContent = `Showing tasks for: ${formatDisplayDate(dateString)}`; ['todo', 'done'].forEach(columnId => { const nitinCol = document.getElementById(`nitin-${columnId}`); if (nitinCol && tasksByUserData.nitin[columnId]) { tasksByUserData.nitin[columnId].forEach(taskData => { const taskElement = createTaskElement(taskData, 'nitin'); nitinCol.appendChild(taskElement); }); } const sathuCol = document.getElementById(`sathu-${columnId}`); if (sathuCol && tasksByUserData.sathu[columnId]) { tasksByUserData.sathu[columnId].forEach(taskData => { const taskElement = createTaskElement(taskData, 'sathu'); sathuCol.appendChild(taskElement); }); } }); } catch (error) { console.error("Error displaying tasks:", error); selectedDateDisplay.textContent = `Error loading tasks for ${formatDisplayDate(dateString)}`; } /* No checkAndMoveTasks needed */ }
        async function saveCurrentBoardState() { if (!db) { console.error("Firestore not initialized."); return; } if (!currentSelectedDate) { console.log("No date selected."); return; } const tasksByUserData = { nitin: { todo: [], done: [] }, sathu: { todo: [], done: [] } }; ['todo', 'done'].forEach(status => { const nitinCol = document.getElementById(`nitin-${status}`); if (nitinCol) { nitinCol.querySelectorAll('.kanban-task').forEach(task => { const taskData = { text: task.dataset.text || '', startTime: task.dataset.startTime || null, endTime: task.dataset.endTime || null, completionDate: task.dataset.completionDate || null }; if (taskData.text) tasksByUserData.nitin[status].push(taskData); }); } const sathuCol = document.getElementById(`sathu-${status}`); if (sathuCol) { sathuCol.querySelectorAll('.kanban-task').forEach(task => { const taskData = { text: task.dataset.text || '', startTime: task.dataset.startTime || null, endTime: task.dataset.endTime || null, completionDate: task.dataset.completionDate || null }; if (taskData.text) tasksByUserData.sathu[status].push(taskData); }); } }); await saveTasksToFirestore(currentSelectedDate, tasksByUserData); }
        async function addTask() { if (!db) { alert("Database not connected."); return; } console.log("addTask function called."); const taskInput = document.getElementById('new-task-input'); const startTimeInput = document.getElementById('new-task-start-time'); const endTimeInput = document.getElementById('new-task-end-time'); const nitinCheckbox = document.getElementById('user-nitin'); const sathuCheckbox = document.getElementById('user-sathu'); if (!taskInput || !startTimeInput || !endTimeInput || !nitinCheckbox || !sathuCheckbox) { console.error("Error: Input/user elements not found."); return; } const assignedUsers = []; if (nitinCheckbox.checked) { assignedUsers.push('nitin'); } if (sathuCheckbox.checked) { assignedUsers.push('sathu'); } if (assignedUsers.length === 0) { alert("Please assign the task to at least one user."); return; } const taskText = taskInput.value.trim(); const startTime = startTimeInput.value; const endTime = endTimeInput.value; if (taskText === '') { alert('Please enter a task description.'); taskInput.focus(); return; } if (!startTime) { alert('Please enter a start time.'); startTimeInput.focus(); return; } if (!endTime) { alert('Please enter an end time.'); endTimeInput.focus(); return; } if (startTime >= endTime) { alert('End time must be after start time.'); endTimeInput.focus(); return; } if (!currentSelectedDate) { alert('Please select a date first.'); return; } const newTaskData = { text: taskText, startTime: startTime, endTime: endTime, completionDate: null }; let elementAdded = false; assignedUsers.forEach(user => { const targetTodoColumn = document.getElementById(`${user}-todo`); if (targetTodoColumn) { const taskElementForUser = createTaskElement(newTaskData, user); if (taskElementForUser) { targetTodoColumn.appendChild(taskElementForUser); elementAdded = true; } else { console.error(`Error creating task element for user ${user}.`); } } else { console.error(`Error: Todo column for user ${user} not found.`); } }); if (elementAdded) { taskInput.value = ''; startTimeInput.value = ''; endTimeInput.value = ''; nitinCheckbox.checked = false; sathuCheckbox.checked = false; } await saveCurrentBoardState(); console.log(`addTask completed for "${taskText}" assigned to ${assignedUsers.join(', ')}`); /* No checkAndMoveTasks */ }
        function handleDragOver(event) { const taskElement = event.target.closest('.kanban-task'); if (taskElement && taskElement.classList.contains('editing')) { return; } event.preventDefault(); const targetColumn = event.target.closest('.kanban-column'); if (targetColumn && !targetColumn.classList.contains('drag-over')) { targetColumn.classList.add('drag-over'); } }
        function handleDragLeave(event) { const targetColumn = event.target.closest('.kanban-column'); if (targetColumn) targetColumn.classList.remove('drag-over'); }
        async function handleDrop(event) { event.preventDefault(); const targetColumn = event.target.closest('.kanban-column'); const targetTask = event.target.closest('.kanban-task'); if (targetTask && targetTask.classList.contains('editing')) { targetColumn?.classList.remove('drag-over'); return; } if (targetColumn && draggedTask) { if (draggedTask === targetTask) { targetColumn.classList.remove('drag-over'); return; } const targetColumnId = targetColumn.id; const targetUser = targetColumnId.startsWith('nitin-') ? 'nitin' : (targetColumnId.startsWith('sathu-') ? 'sathu' : null); const currentAssignedUser = draggedTask.dataset.assignedUser; if (targetUser !== currentAssignedUser) { console.log(`Prevented moving task between users: ${currentAssignedUser} to ${targetUser}`); targetColumn.classList.remove('drag-over'); return; } if (!targetColumnId.endsWith('-todo') && !targetColumnId.endsWith('-done')) { console.log(`Prevented drop into invalid column: ${targetColumnId}`); targetColumn.classList.remove('drag-over'); return; } const previousColumn = draggedTask.parentElement; let completionDate = draggedTask.dataset.completionDate || null; const existingDateSpan = draggedTask.querySelector('.task-completion-date'); if (existingDateSpan) existingDateSpan.remove(); if (targetColumnId.endsWith('-done')) { completionDate = getCurrentDateString(BOSTON_TIMEZONE); draggedTask.dataset.completionDate = completionDate; const dateSpan = document.createElement('span'); dateSpan.classList.add('task-completion-date'); dateSpan.textContent = `Completed: ${completionDate}`; const timeInfo = draggedTask.querySelector('.task-time-info'); if (timeInfo) { timeInfo.insertAdjacentElement('afterend', dateSpan); } else { draggedTask.appendChild(dateSpan); } if (previousColumn && !previousColumn.id.endsWith('-done')) { triggerConfetti(); } } else { delete draggedTask.dataset.completionDate; completionDate = null; } targetColumn.appendChild(draggedTask); targetColumn.classList.remove('drag-over'); await saveCurrentBoardState(); } else if (targetColumn) { targetColumn.classList.remove('drag-over'); } }
        function triggerConfetti() { myConfetti({ particleCount: 200, spread: 100, origin: { y: 0.6 }, colors: ['#f97316', '#ef4444', '#facc15', '#ffffff', '#a855f7'] }); }
        async function archiveTaskToFirestore(taskData, assignedUser) { if (!db || !archiveCollection) { console.error("Firestore not initialized."); return; } if (!taskData.completionDate || !taskData.text || !assignedUser) { console.warn("Skipping archive for task missing data:", taskData); return; } const archiveData = { ...taskData, assignedUser: assignedUser, archivedAt: firebase.firestore.FieldValue.serverTimestamp() }; try { await archiveCollection.add(archiveData); console.log(`Task for ${assignedUser} archived:`, taskData.text); } catch (error) { console.error("Error archiving task:", error); } }
        async function runArchivingProcess() { if (!db || !tasksCollection || !archiveCollection) { console.error("Firestore not initialized."); return false; } const todayDateStr = getCurrentDateString(BOSTON_TIMEZONE); let tasksArchived = false; console.log("Running archiving process..."); try { const querySnapshot = await tasksCollection.where(firebase.firestore.FieldPath.documentId(), "<", todayDateStr).get(); if (querySnapshot.empty) { console.log("No past dates found."); return false; } const updates = []; querySnapshot.forEach(doc => { const dateString = doc.id; const tasksByUserData = doc.data(); let dayWasModified = false; const updatedTasksByUserData = { nitin: { todo: tasksByUserData.nitin?.todo || [], done: tasksByUserData.nitin?.done || [] }, sathu: { todo: tasksByUserData.sathu?.todo || [], done: tasksByUserData.sathu?.done || [] } }; if (updatedTasksByUserData.nitin.done && updatedTasksByUserData.nitin.done.length > 0) { const tasksToKeep = []; updatedTasksByUserData.nitin.done.forEach(taskData => { if (taskData.completionDate) { updates.push(archiveTaskToFirestore(taskData, 'nitin')); tasksArchived = true; dayWasModified = true; } else { tasksToKeep.push(taskData); } }); updatedTasksByUserData.nitin.done = tasksToKeep; } if (updatedTasksByUserData.sathu.done && updatedTasksByUserData.sathu.done.length > 0) { const tasksToKeep = []; updatedTasksByUserData.sathu.done.forEach(taskData => { if (taskData.completionDate) { updates.push(archiveTaskToFirestore(taskData, 'sathu')); tasksArchived = true; dayWasModified = true; } else { tasksToKeep.push(taskData); } }); updatedTasksByUserData.sathu.done = tasksToKeep; } if (dayWasModified) { updates.push(tasksCollection.doc(dateString).set(updatedTasksByUserData)); console.log(`Marked document ${dateString} for update.`); } }); await Promise.allSettled(updates); console.log("Archiving process potentially completed."); } catch (error) { console.error("Error during archiving process query:", error); } return tasksArchived; }
        function generateSummaryText(tasks) { if (!tasks || tasks.length === 0) { return "No tasks were completed on this day. Plan the next win!"; } const tasksByAssignee = tasks.reduce((acc, task) => { const user = task.assignedUser || 'unknown'; if (!acc[user]) acc[user] = []; acc[user].push(task.text); return acc; }, {}); let summary = `Recap of today's wins! `; const userSummaries = []; if (tasksByAssignee.nitin && tasksByAssignee.nitin.length > 0) { userSummaries.push(`Nitin crushed ${tasksByAssignee.nitin.length} task(s): <strong>${tasksByAssignee.nitin.join('</strong>, <strong>')}</strong>`); } if (tasksByAssignee.sathu && tasksByAssignee.sathu.length > 0) { userSummaries.push(`Sathu crushed ${tasksByAssignee.sathu.length} task(s): <strong>${tasksByAssignee.sathu.join('</strong>, <strong>')}</strong>`); } if (tasksByAssignee.unknown && tasksByAssignee.unknown.length > 0) { userSummaries.push(`Unassigned tasks completed: <strong>${tasksByAssignee.unknown.join('</strong>, <strong>')}</strong>`); } summary += userSummaries.join('. ') + (userSummaries.length > 0 ? '.' : ''); return summary + " Keep that momentum going! 🚀"; }
        async function displayLatestSummary() { if (!db || !archiveCollection) { console.error("Firestore not initialized."); dailySummaryDiv.classList.add('hidden'); return; } console.log("Fetching latest summary..."); try { const querySnapshot = await archiveCollection.orderBy("completionDate", "desc").orderBy("archivedAt", "desc").limit(50).get(); if (querySnapshot.empty) { dailySummaryDiv.classList.add('hidden'); console.log("No archived tasks found."); return; } let latestDate = null; const tasksForLatestDate = []; querySnapshot.forEach(doc => { const taskData = doc.data(); if (taskData.completionDate) { if (!latestDate) { latestDate = taskData.completionDate; } if (taskData.completionDate === latestDate) { tasksForLatestDate.push(taskData); } } }); if (latestDate && tasksForLatestDate.length > 0) { summaryContentP.innerHTML = generateSummaryText(tasksForLatestDate); dailySummaryDiv.querySelector('h3').textContent = `Daily Wins Recap for ${formatDisplayDate(latestDate)}!`; dailySummaryDiv.classList.remove('hidden'); console.log(`Displaying summary for ${latestDate}`); } else { dailySummaryDiv.classList.add('hidden'); console.log("Could not determine latest summary date."); } } catch (error) { console.error("Error fetching archived tasks for summary:", error); dailySummaryDiv.classList.add('hidden'); } }

        // --- Motivational Quote Display ---
        function displayMotivationalQuote() { if (!quoteDisplay) return; let randomIndex; do { randomIndex = Math.floor(Math.random() * motivationalQuotes.length); } while (randomIndex === currentQuoteIndex && motivationalQuotes.length > 1); currentQuoteIndex = randomIndex; quoteDisplay.textContent = motivationalQuotes[currentQuoteIndex]; }

        // --- Notes Page Functions ---
        async function loadAndDisplayNotes(user) { if (!db) return; console.log(`Loading notes for ${user}`); const notesData = await loadNotesFromFirestore(user); displayPrioritizedTasks(user, notesData.prioritizedTasks); const textarea = document.getElementById(`${user}-freeform-notes`); if (textarea) { textarea.value = notesData.freeformNotes || ""; } }
        function displayPrioritizedTasks(user, tasks) { const listElement = document.getElementById(`${user}-prioritized-tasks`); if (!listElement) return; listElement.innerHTML = ''; if (!tasks || tasks.length === 0) { listElement.innerHTML = '<li class="text-slate-400 italic text-sm p-2">No prioritized tasks yet.</li>'; return; } tasks.sort((a, b) => (PRIORITY_MAP[b.priority] || 0) - (PRIORITY_MAP[a.priority] || 0)); tasks.forEach((task, index) => { const li = document.createElement('li'); li.classList.add('prioritized-task-item'); li.dataset.index = index; const textSpan = document.createElement('span'); textSpan.textContent = task.text; const priorityBadge = document.createElement('span'); priorityBadge.classList.add('priority-badge', `priority-${task.priority}`); priorityBadge.textContent = task.priority; const deleteBtn = document.createElement('button'); deleteBtn.classList.add('delete-note-task-btn'); deleteBtn.innerHTML = '&times;'; deleteBtn.title = "Delete task"; deleteBtn.onclick = async () => { if (confirm(`Delete prioritized task: "${task.text}"?`)) { await deletePrioritizedTask(user, index); } }; li.appendChild(textSpan); li.appendChild(priorityBadge); li.appendChild(deleteBtn); listElement.appendChild(li); }); }
        async function addPrioritizedTask(user, event) { event.preventDefault(); if (!db) { alert("Database not connected."); return; } const taskInput = document.getElementById(`${user}-note-task`); const prioritySelect = document.getElementById(`${user}-note-priority`); if (!taskInput || !prioritySelect) return; const taskText = taskInput.value.trim(); const priority = prioritySelect.value; if (!taskText) { alert("Please enter a task description."); taskInput.focus(); return; } const newTask = { text: taskText, priority: priority, createdAt: firebase.firestore.FieldValue.serverTimestamp() }; const currentNotes = await loadNotesFromFirestore(user); const updatedTasks = [...currentNotes.prioritizedTasks, newTask]; await saveNotesToFirestore(user, { prioritizedTasks: updatedTasks, freeformNotes: currentNotes.freeformNotes }); displayPrioritizedTasks(user, updatedTasks); taskInput.value = ''; prioritySelect.value = 'Mandatory'; }
        async function deletePrioritizedTask(user, taskIndex) { if (!db) { alert("Database not connected."); return; } const currentNotes = await loadNotesFromFirestore(user); const updatedTasks = currentNotes.prioritizedTasks.filter((_, index) => index !== taskIndex); await saveNotesToFirestore(user, { prioritizedTasks: updatedTasks, freeformNotes: currentNotes.freeformNotes }); displayPrioritizedTasks(user, updatedTasks); }
        async function saveFreeformNotes(user) { if (!db) { alert("Database not connected."); return; } const textarea = document.getElementById(`${user}-freeform-notes`); if (!textarea) return; const notesText = textarea.value; const currentNotes = await loadNotesFromFirestore(user); await saveNotesToFirestore(user, { prioritizedTasks: currentNotes.prioritizedTasks, freeformNotes: notesText }); alert(`${user.charAt(0).toUpperCase() + user.slice(1)}'s notes saved!`); }

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', async () => {
            updateTimeDisplay(); setInterval(updateTimeDisplay, 60000);
            displayMotivationalQuote();
            await new Promise(resolve => setTimeout(resolve, 1500));
            if (!db) { console.error("DB not initialized. Aborting further setup."); selectedDateDisplay.textContent = "Database Connection Failed!"; return; }

            // Setup Navigation
            navigationButtons.forEach(button => { button.addEventListener('click', () => switchView(button.dataset.view)); });

            // Setup Notes Form Submissions & Save Buttons
            const nitinNotesForm = document.getElementById('nitin-notes-form'); const sathuNotesForm = document.getElementById('sathu-notes-form'); const saveNitinNotesBtn = document.getElementById('save-nitin-notes'); const saveSathuNotesBtn = document.getElementById('save-sathu-notes');
            if (nitinNotesForm) nitinNotesForm.addEventListener('submit', (e) => addPrioritizedTask('nitin', e));
            if (sathuNotesForm) sathuNotesForm.addEventListener('submit', (e) => addPrioritizedTask('sathu', e));
            if (saveNitinNotesBtn) saveNitinNotesBtn.addEventListener('click', () => saveFreeformNotes('nitin'));
            if (saveSathuNotesBtn) saveSathuNotesBtn.addEventListener('click', () => saveFreeformNotes('sathu'));

            // Initial Setup for Board View
            try { await runArchivingProcess(); } catch (error) { console.error("Error during initial archiving:", error); }
            const currentBostonDate = getCurrentDateString(BOSTON_TIMEZONE);
            if (dateSelector) {
                dateSelector.value = currentBostonDate;
                switchView('hustle-board-view'); // Load board view by default
                dateSelector.addEventListener('change', (event) => { if (currentView === 'hustle-board-view') { displayTasksForDate(event.target.value); } else { currentSelectedDate = event.target.value; } });
            } else { console.error("Date selector element not found."); }
            await displayLatestSummary();

            // Kanban Add Task Button Listener
            const addTaskBtnLocal = document.getElementById('add-task-btn');
            if (addTaskBtnLocal) { addTaskBtnLocal.addEventListener('click', addTask); /* Keypress listeners can be added back if desired */ }
            else { console.error("Add task button not found."); }

            // Removed task check interval setup
            console.log("App Initialized.");
        });

    </script>

</body>
</html>
